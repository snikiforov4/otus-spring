SET search_path = usr;

CREATE TABLE genre
(
   id SERIAL PRIMARY KEY,
   name VARCHAR(64) NOT NULL CONSTRAINT genre_name_unique UNIQUE
);

CREATE TABLE author
(
   id SERIAL PRIMARY KEY,
   first_name VARCHAR(64) NOT NULL,
   last_name VARCHAR(64) NOT NULL
);

CREATE TABLE book
(
   id SERIAL PRIMARY KEY,
   title VARCHAR(256) NOT NULL,
   genre_id INT NULL CONSTRAINT fk_book_genre REFERENCES genre(id) ON DELETE RESTRICT ON UPDATE CASCADE
);

CREATE TABLE author_book
(
   author_id INT NOT NULL CONSTRAINT fk_author_book REFERENCES author(id) ON DELETE RESTRICT ON UPDATE CASCADE,
   book_id INT NOT NULL CONSTRAINT fk_book_author REFERENCES book(id) ON DELETE RESTRICT ON UPDATE CASCADE,
   PRIMARY KEY(author_id, book_id)
);

CREATE TABLE book_comment
(
   id SERIAL PRIMARY KEY,
   create_date TIMESTAMP WITH TIME ZONE NOT NULL,
   text VARCHAR(255) NOT NULL,
   book_id INT NOT NULL CONSTRAINT fk_book_comment_book REFERENCES book(id) ON DELETE CASCADE ON UPDATE CASCADE
);
